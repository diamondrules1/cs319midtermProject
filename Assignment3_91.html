<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment3</title>
</head>
<body>
    <h1>Get Method.</h1>
    <button onclick="getMethod()">Show All Products</button>
    <h1>Get MethodById.</h1>
    <form id="getById">
        <label for="getid">Id:</label>
        <input type="number" id="getid" name="getid">
    </form>
    <button onclick="getMethodById()">Show Product by ID</button>
    <h1>Post Method. </h1>
    <form id="create">
        <label for="title">Title:</label>
        <input type="text" id="title" name="title"><br>
        <label for="price">Price:</label>
        <input type="number" id="price" name="price"><br>
        <label for="desc">Description:</label>
        <input type="text" id="desc" name="desc"><br>
        <label for="category">Category:</label>
        <input type="text" id="category" name="category"><br>
        <label for="pic">Image:</label>
        <input type="file" id="pic" name="pic"><br>
        <label for="rate">Rate:</label>
        <input type="number" id="rate" name="rate"><br>
        <label for="count">Count:</label>
        <input type="number" id="count" name="count"><br>
    </form>
    <button onclick="postMethod()">Post user</button>
    <h1>DELETE Method .</h1>
    <form id="deleteById">
        <label for="deleteId">Id:</label>
        <input type="number" id="deleteId" name="deleteId">
    </form>
    <button onclick="deleteMethod()">Delete</button>
    <hr>
    <h1>Output:</h1>
    <pre id="showData"></pre>
    <script>
        let y = 0;
function getMethod() {
    fetch('http://localhost:8081/listProducts')
    .then(response => response.json())
    .then(data => {
        console.log(data);
        var container = document.getElementById("showData");
        container.innerHTML = JSON.stringify(data,undefined,2);
    })
};
function getMethodById() {
    fetch('http://localhost:8081/' + document.getElementById("getid").value)
    .then(response => response.json())
    .then(data => {
        console.log(data);
        var container = document.getElementById("showData");
        container.innerHTML = JSON.stringify(data,undefined,2);
    });
};
function postMethod() {
    let r = getNextId();
    fetch('http://localhost:8081/addProduct', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({
            "product":{
                "_id": r,
                "title": document.getElementById("title").value,
                "price": document.getElementById("price").value,
                "description": document.getElementById("desc").value,
                "category":document.getElementById("category").value,
                "image": document.getElementById("pic").value,
                "rating":{
                    "rate": document.getElementById("rate").value,
                    "count": document.getElementById("count").value
                }
            }
            
        })
        })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        var container = document.getElementById("showData");
        container.innerHTML = JSON.stringify(data);
    });
}
function deleteMethod() {
    let s = "product"+document.getElementById("deleteId").value;
    console.log("Lets do Delete ....");
    fetch('http://localhost:8081/deleteProduct', {
        method: "DELETE",
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({
            s: {
            
        }
    })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch((err) => console.log("Error:" + err));
}
function getNextId(){
    fetch('http://localhost:8081/nextId')
    .then(response => response.json())
    .then(data => {
        y = 0;
        for (let x of data){
            y++;
        }
        y++;
        console.log("Next id is: ", y);
    })
}
</script>
</body>
</body>
</html>